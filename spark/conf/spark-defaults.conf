# ============================
# Spark Cluster Configuration
# ============================

# Master URL mặc định (Spark Master container)
spark.master spark://spark-master:7077

# App name mặc định
spark.app.name SparkApp

# Nơi Spark lưu cache tạm & shuffle data
spark.local.dir /tmp/spark

# Ivy cache (tải package jar bên ngoài nếu cần)
spark.jars.ivy /tmp/.ivy2
spark.jars.packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.5.0

# Fix cổng mạng driver để worker kết nối ổn định (tránh random)
spark.driver.host spark-master
spark.driver.port 40443
spark.blockManager.port 6060

# Ép dùng LZ4 thay vì ZSTD để tránh lỗi native zstd-jni
spark.io.compression.codec lz4
spark.shuffle.mapStatus.compression.codec lz4

# ============================
# Spark SQL Config
# ============================

# Số lượng partitions khi shuffle (tối ưu cho máy local nhỏ)
spark.sql.shuffle.partitions 4

# Luôn dùng local filesystem, tránh HDFS/Kerberos
spark.hadoop.fs.defaultFS file:///
spark.sql.warehouse.dir file:///tmp/spark-warehouse
spark.hadoop.fs.viewfs.impl.disable true
spark.hadoop.fs.AbstractFileSystem.viewfs.impl org.apache.hadoop.fs.UnsupportedFileSystem

# Vô hiệu hóa Kerberos hoàn toàn
spark.hadoop.hadoop.security.authentication Simple
spark.hadoop.hadoop.security.authorization false

# Định nghĩa rõ ràng user name cho HDFS, dù không dùng
spark.hadoop.fs.hdfs.impl.disable.cache true
spark.hadoop.fs.hdfs.impl org.apache.hadoop.fs.RawLocalFileSystem

# ============================
# Memory Config
# ============================

# Tuỳ RAM máy bạn, có thể chỉnh lên 2G/4G nếu cần
spark.driver.memory 1G
spark.executor.memory 1G
